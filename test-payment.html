<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Midtran Test</title>
  <script src="https://app.sandbox.midtrans.com/snap/snap.js" data-client-key="Mid-client-0rxk4NYmmZpsfrJV"></script>
</head>
<body>
  <h2>Midtrans Snap Popup Test</h2>
  <button id="pay-btn">Pay Now</button>

  <script>
    const payBtn = document.getElementById("pay-btn");

    payBtn.addEventListener("click", async () => {
      // 1️⃣ Request Snap token dari serverless
      const res = await fetch("/api/create-snap", { method: "POST" });
      const data = await res.json();

      if (data.token) {
        // 2️⃣ Panggil Snap popup
        snap.pay(data.token, {
          onSuccess: result => console.log("Success:", result),
          onPending: result => console.log("Pending:", result),
          onError: result => console.log("Error:", result),
          onClose: () => console.log("Popup closed")
        });
      } else {
        alert("Error creating transaction:\n" + JSON.stringify(data, null, 2));
      }
    });
  </script>
</body>
</html>