<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Midtrans Snap Popup Test</title>
  <script src="https://app.sandbox.midtrans.com/snap/snap.js" data-client-key="Mid-client-0rxk4NYmmZpsfrJV"></script>
</head>
<body>
  <h2>Midtrans Snap Tet</h2>

  <select id="payment-select">
    <option value="gopay">GoPay</option>
    <option value="qris">QRIS</option>
    <option value="credit_card">Credit Card</option>
    <option value="bank_transfer">Bank Transfer</option>
  </select>

  <button id="pay-btn">Pay Now</button>

  <script>
    const payBtn = document.getElementById("pay-btn");
    const paymentSelect = document.getElementById("payment-select");

    payBtn.addEventListener("click", async () => {
      const paymentType = paymentSelect.value;

      // 1️⃣ Ambil Snap token dari serverless
      const res = await fetch("/api/create-snap", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ payment_type: paymentType })
      });
      const data = await res.json();

      if (data.token) {
        // 2️⃣ Panggil Snap popup
        snap.pay(data.token, {
          onSuccess: result => console.log("Success:", result),
          onPending: result => console.log("Pending:", result),
          onError: result => console.log("Error:", result),
          onClose: () => console.log("Popup closed")
        });
      } else {
        alert("Error creating transaction:\n" + JSON.stringify(data, null, 2));
      }
    });
  </script>
</body>
</html>